https://www.sciencedirect.com/science/article/pii/S0167642317302186
-----------------------------------------------------------

local protocol SMPT_C(role S, self C) {
    _220(String) from S; ...
    rec X1 {
        choice at S {
            _250dash(String) from S;
            continue X1;
        }
        or
        {
            _250(String) from S; ...
            rec Z1 {
                ... data(String) to S; ...
                rec Z3 {
                    choice at C {
                        subject(String) to S; continue Z3;
                    }
                    or
                    {
                        dataline(String) to S; continue Z3;
                    }
                    or
                    {
                        atad(String) to S;, _250(String) from S; continue Z1;
                    }
                }
            }
        }
    }
}


C_smtp = ?220(option : String)[(option == "dash") || (option == "normal")].rec X1.(
    &{
        ?250dash(string : String).X1,
        ?250(choice : String)[(choice == option) && (option == "normal")].rec Z1.(
            !Data(data : String)[(choice == "subject") || (choice == "dataline") || (choice == "atad")].rec Z3.(
                +{
                    !Subject(subject : String)[choice == "subject"].Z3,
                    !Dataline(dataline : String)[choice == "dataline"].Z3,
                    !atad(dot : String)[(choice == "atad") && (dot == ".")].Z1
                }
            )
        )
    }
)

dash = 1
normal = 2
subject = 3
dataline = 4
atad = 5
. = 6

C_smtp = ?TwoTwoZero(option : Int)[(option == 1) || (option == 2)].rec X1.(
    &{
        ?TwoFiveZeroDash(string : String).X1,
        ?TwoFiveZero(choice : Int)[(choice == option) && (option == 1)].rec Z1.(
            !Data(data : String)[(choice == 3) || (choice == 4) || (choice == 5)].rec Z3.(
                +{
                    !Subject(subject : String)[choice == 3].Z3,
                    !Dataline(dataline : String)[choice == 4].Z3,
                    !atad(dot : String)[(choice == 5) && (dot == ".")].Z1
                }
            )
        )
    }
)