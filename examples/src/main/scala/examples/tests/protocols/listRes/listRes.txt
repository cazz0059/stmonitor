S_listRes = ?Request(resource_kind : String, subject:String, resource:String, operation:String, certificate:String)[util.checkPrivilege(subject, resource, operation, certificate)].+{
    !Ok().rec X.(
        +{
            !Response(element : ListingFormat).X,
            !Completed()
        }
    ),
    !Error(reason:String)[(operation == null) || (certificate == null)]
}

---------------------------------------------------------------

http://mrg.doc.ic.ac.uk/publications/structuring-communication-with-session-types/main.pdf page 13 fig 5

protocol ListResources(role client as cl, role resource_registry as rr) {
    request(resource_kind:String) from cl to rr;
    rec loop {
        choice at rr {
            response(element:Format) from rr to cl;
            continue loop;
        }
        or
        {
            completed() from rr to cl;
        }
    }
}

THIS FEATURE WAS REMOVED : adding the uri condition instead of just assigning the type of resource and subject to URI is on purpose

changed nested protocol to assertion
